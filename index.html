<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>March Madness Bracket Predictor</title>
    <script src="https://res.cdn.office.net/teams-js/2.0.0/js/MicrosoftTeams.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #121212;
            color: #e0e0e0;
        }
        .container {
            background-color: #1e1e1e;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
        }
        h1 {
            color: #bb86fc;
            margin-bottom: 20px;
        }
        button {
            background-color: #6264A7;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            display: block;
            margin: 1rem 0;
        }
        button:hover {
            background-color: #4b4c8c;
        }
        .results {
            margin-top: 20px;
            border-top: 1px solid #ddd;
            padding-top: 20px;
        }
        .round {
            margin-bottom: 15px;
        }
        .round-title {
            font-weight: bold;
            color: #bb86fc;
            margin-bottom: 10px;
            font-size: 18px;
        }
        .matchup {
            background-color: #2d2d2d;
            color: #e0e0e0;
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 4px;
        }
        .winner {
            font-weight: bold;
            color: #03dac6;
        }
        .champion {
            text-align: center;
            font-size: 24px;
            margin: 30px 0;
            font-weight: bold;
            color: #107C10;
            padding: 20px;
            background-color: #2d2d2d;
            color: #03dac6;
            border-radius: 4px;
        }
        .team-data {
            margin-top: 30px;
        }
        .save-button {
            background-color: #107C10;
        }
        .save-button:hover {
            background-color: #0b5e0b;
        }
        #loading {
            text-align: center;
            display: none;
            margin: 20px 0;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #6264A7;
            animation: spin 1s ease infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        table th {
            background-color: #2d2d2d !important;
            color: #bb86fc !important;
            border-color: #444 !important;
        }
        table td {
            border-color: #444 !important;
            color: #e0e0e0 !important;
        }
        .actual-result {
            font-weight: bold;
            color: #fc7fb1;
        }
        .status-indicator {
            display: flex;
            margin: 15px 0;
        }
        .status-box {
            padding: 5px 10px;
            margin: 0 5px;
            border-radius: 4px;
            font-size: 14px;
        }
        .status-actual {
            background-color: #fc7fb1;
            color: #000;
        }
        .status-predicted {
            background-color: #03dac6;
            color: #000;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>March Madness Bracket Predictor 2025</h1>

        <div id="currentRoundInfo">Current Tournament Status: Loading...</div>
        <div id="apiStatus" class="api-status"></div>

        <div class="controls">
            <button id="loadActualResults">Load Actual Results</button>
            <button id="simulateRemainingButton">Simulate Remaining Games</button>
            <button id="simulateFullButton">Simulate Full Tournament</button>
            <button id="statsButton">Generate Historical Stats</button>
        </div>

        <div class="status-indicator">
            <div class="status-box status-actual">Actual Result</div>
            <div class="status-box status-predicted">Predicted Result</div>
        </div>
        
        <div id="loading">
            <div class="spinner"></div>
            <p>Running simulation...</p>
        </div>
        
        <div id="results" class="results"></div>
        <div id="statsResults" class="results" style="display: none;"></div>
        
        <button id="saveButton" class="save-button" style="display: none;">Save Results</button>
    </div>
    
    <script>
        // Initialize Teams SDK
        microsoftTeams.initialize();

        // Tournament tracking
        const tournamentStatus = {
            currentRound: "Not Started", // Will be updated from API
            completedGames: [],  // Will store actual results from API
            isLoaded: false
        };

        // Function to fetch actual tournament results from API
        async function fetchTournamentResults() {
            try {
                document.getElementById('apiStatus').textContent = "Fetching tournament data...";
    
                // Call your deployed API
                const response = await fetch('https://thargenediad-github-io.vercel.app/api/tournament-results');
                const data = await response.json();
                
                // Update tournament status
                tournamentStatus.currentRound = data.tournamentStatus;
                tournamentStatus.completedGames = data.completedGames;
                tournamentStatus.isLoaded = true;
                
                // Update UI
                document.getElementById('currentRoundInfo').textContent = `Current Tournament Status: ${tournamentStatus.currentRound}`;
                document.getElementById('apiStatus').textContent = `Successfully loaded ${tournamentStatus.completedGames.length} completed games.`;
                
                return data;
            } catch (error) {
                console.error("Error fetching tournament data:", error);
                document.getElementById('apiStatus').textContent = "Error loading tournament data. Using prediction mode only.";
                return null;
            }
        }
        
        // Team data with statistics based on KenPom and other metrics
        const teamData = {
            // 1 Seeds
            "Duke": {
                kenpomRank: 1,
                offensiveEfficiency: 127.9,
                defensiveEfficiency: 89.8, 
                recentForm: 9,               // Subjective: Strong recent performance, dominated late regular season
                injuryImpact: 6,             // Subjective: Cooper Flagg ankle injury is concerning
                tournamentExperience: 10,    // Subjective: Program with rich tournament history, multiple championships
                region: "East"
            },
            "Florida": {
                kenpomRank: 2,
                offensiveEfficiency: 128.7,
                defensiveEfficiency: 92.5, 
                recentForm: 8,               // Subjective: Strong finish to season, SEC tournament final
                injuryImpact: 9,             // Subjective: Team largely healthy heading into tournament
                tournamentExperience: 7,     // Subjective: Moderate tournament history, past Final Fours
                region: "West"
            },
            "Auburn": {
                kenpomRank: 4,
                offensiveEfficiency: 128.5,
                defensiveEfficiency: 93.4, 
                recentForm: 3,               // Subjective: Lost 3 of last 4 before tournament
                injuryImpact: 9,             // Subjective: No major injuries reported
                tournamentExperience: 7,     // Subjective: Moderate tournament history, recent Final Four
                region: "Midwest"
            },
            "Houston": {
                kenpomRank: 3,
                offensiveEfficiency: 123.2,
                defensiveEfficiency: 87.8, 
                recentForm: 9,               // Subjective: Won Big 12 regular season and tournament
                injuryImpact: 9,             // Subjective: Team largely healthy, no key injuries
                tournamentExperience: 9,     // Subjective: Multiple deep runs in recent years including Final Four
                region: "South"
            },
            
            // 2 Seeds
            "Tennessee": {
                kenpomRank: 5,
                offensiveEfficiency: 120.3,
                defensiveEfficiency: 89.2, 
                recentForm: 7,               // Subjective: Solid recent performance in tough SEC
                injuryImpact: 8,             // Subjective: Minor injury concerns but team mostly healthy
                tournamentExperience: 8,     // Subjective: Good tournament history but no Final Fours
                region: "East"
            },
            "Alabama": {
                kenpomRank: 6,
                offensiveEfficiency: 126.6,
                defensiveEfficiency: 96.6, 
                recentForm: 3,               // Subjective: Lost 2 in a row before tournament
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 9,     // Subjective: Strong tournament history with Elite Eight runs
                region: "West"
            },
            "Michigan State": {
                kenpomRank: 8,
                offensiveEfficiency: 118.2,
                defensiveEfficiency: 90.6, 
                recentForm: 8,               // Subjective: Strong finish to season, Big Ten tournament
                injuryImpact: 9,             // Subjective: Team largely healthy for tournament
                tournamentExperience: 10,    // Subjective: Izzo in March gives high experience rating
                region: "Midwest"
            },
            "St. John's": {
                kenpomRank: 11,
                offensiveEfficiency: 114.0,
                defensiveEfficiency: 87.4, 
                recentForm: 9,               // Subjective: Strong recent performance, Big East champions
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 7,     // Subjective: Moderate tournament history, some past success
                region: "South"
            },
            
            // 3 Seeds
            "Texas Tech": {
                kenpomRank: 7,
                offensiveEfficiency: 125.4,
                defensiveEfficiency: 97.3, 
                recentForm: 7,               // Subjective: Beat Houston, solid finish in tough Big 12
                injuryImpact: 9,             // Subjective: Team largely healthy for tournament
                tournamentExperience: 7,     // Subjective: Moderate tournament history with recent finals run
                region: "Midwest"
            },
            "Wisconsin": {
                kenpomRank: 13,
                offensiveEfficiency: 122.1,
                defensiveEfficiency: 96.1, 
                recentForm: 7,               // Subjective: Solid recent performance in Big Ten
                injuryImpact: 8,             // Subjective: Minor injury concerns with rotation players
                tournamentExperience: 8,     // Subjective: Good tournament history with past Final Fours
                region: "West"
            },
            "Kentucky": {
                kenpomRank: 16,
                offensiveEfficiency: 123.8,
                defensiveEfficiency: 99.6, 
                recentForm: 4,               // Subjective: Underwhelming finish to season, early SEC exit
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 9,     // Subjective: Strong tournament history, multiple championships
                region: "South"
            },
            "Iowa State": {
                kenpomRank: 10,
                offensiveEfficiency: 119.5,
                defensiveEfficiency: 92.5, 
                recentForm: 8,               // Subjective: Strong finish to season in top Big 12
                injuryImpact: 6,             // Subjective: Gilbert injury impacts team depth
                tournamentExperience: 8,     // Subjective: Good tournament history with Sweet 16 runs
                region: "East"
            },
            
            // 4 Seeds
            "Arizona": {
                kenpomRank: 14,
                offensiveEfficiency: 122.6,
                defensiveEfficiency: 96.9, 
                recentForm: 6,               // Subjective: Average recent performance, inconsistent in Pac-12
                injuryImpact: 8,             // Subjective: Minor injury concerns to rotation players
                tournamentExperience: 8,     // Subjective: Good tournament history with Final Four appearances
                region: "South"
            },
            "Purdue": {
                kenpomRank: 18,
                offensiveEfficiency: 124.3,
                defensiveEfficiency: 100.5, 
                recentForm: 7,               // Subjective: Solid recent performance after midseason struggles
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 8,     // Subjective: Good tournament history but recent early exits
                region: "Midwest"
            },
            "Maryland": {
                kenpomRank: 12,
                offensiveEfficiency: 118.2,
                defensiveEfficiency: 91.8, 
                recentForm: 7,               // Subjective: Solid recent performance in Big Ten play
                injuryImpact: 9,             // Subjective: Team largely healthy for tournament
                tournamentExperience: 8,     // Subjective: Good tournament history with championship
                region: "West"
            },
            "Texas A&M": {
                kenpomRank: 17,
                offensiveEfficiency: 116.2,
                defensiveEfficiency: 92.1, 
                recentForm: 5,               // Subjective: One-and-done in SEC tournament, inconsistent
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 7,     // Subjective: Moderate tournament history, Sweet 16 runs
                region: "East"
            },
            
            // 5 Seeds
            "Oregon": {
                kenpomRank: 32,
                offensiveEfficiency: 116.7,
                defensiveEfficiency: 96.6, 
                recentForm: 7,               // Subjective: Solid recent performance, Pac-12 contender
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 7,     // Subjective: Moderate tournament history with Final Four run
                region: "Midwest"
            },
            "Clemson": {
                kenpomRank: 19,
                offensiveEfficiency: 118.7,
                defensiveEfficiency: 94.9, 
                recentForm: 7,               // Subjective: 27 wins (most in program history)
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 7,     // Subjective: Made Elite Eight last season
                region: "South"
            },
            "Michigan": {
                kenpomRank: 24,
                offensiveEfficiency: 116.1,
                defensiveEfficiency: 93.7, 
                recentForm: 8,               // Subjective: Won Big Ten Tournament, peaking at right time
                injuryImpact: 9,             // Subjective: Team largely healthy for tournament
                tournamentExperience: 8,     // Subjective: Good tournament history with championship
                region: "East"
            },
            "Memphis": {
                kenpomRank: 50,
                offensiveEfficiency: 113.3,
                defensiveEfficiency: 97.8, 
                recentForm: 7,               // Subjective: Solid recent performance, won key games late
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 7,     // Subjective: Moderate tournament history with Final Four
                region: "West"
            },
            
            // 6 Seeds
            "Missouri": {
                kenpomRank: 15,
                offensiveEfficiency: 124.2,
                defensiveEfficiency: 100.7,
                recentForm: 7,               // Subjective: Solid recent performance after turnaround season
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 6,     // Subjective: Some tournament history, Elite Eight runs
                region: "Midwest"
            },
            "BYU": {
                kenpomRank: 23,
                offensiveEfficiency: 123.1,
                defensiveEfficiency: 100.7, 
                recentForm: 9,               // Subjective: Strong performance in tough Big 12, late win streak
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 6,     // Subjective: Moderate tournament history, some Sweet 16s
                region: "West"
            },
            "Ole Miss": {
                kenpomRank: 25,
                offensiveEfficiency: 117.9,
                defensiveEfficiency: 95.8, 
                recentForm: 7,               // Subjective: Solid recent performance, SEC tournament win
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 6,     // Subjective: Limited recent tournament success
                region: "South"
            },
            "Illinois": {
                kenpomRank: 20,
                offensiveEfficiency: 121.7,
                defensiveEfficiency: 98.1,
                recentForm: 7,               // Subjective: Solid recent performance despite loss to Duke
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 8,     // Subjective: Good tournament history with Final Four runs
                region: "East"
            },
            
            // 7 Seeds
            "Kansas": {
                kenpomRank: 21,
                offensiveEfficiency: 116.0,
                defensiveEfficiency: 92.7, 
                recentForm: 6,               // Subjective: Average recent performance, struggled late
                injuryImpact: 7,             // Subjective: Some injury concerns for key players
                tournamentExperience: 10,    // Subjective: Elite tournament history, multiple championships
                region: "East"
            },
            "UCLA": {
                kenpomRank: 28,
                offensiveEfficiency: 116.9,
                defensiveEfficiency: 95.1, 
                recentForm: 6,               // Subjective: Average recent performance in Pac-12
                injuryImpact: 8,             // Subjective: Minor injury concerns for rotation
                tournamentExperience: 9,     // Subjective: Strong tournament history, multiple championships
                region: "South"
            },
            "Saint Mary's": {
                kenpomRank: 22,
                offensiveEfficiency: 115.4,
                defensiveEfficiency: 92.2, 
                recentForm: 7,               // Subjective: Solid recent performance, WCC runner-up
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 7,     // Subjective: Moderate tournament history, Sweet 16 runs
                region: "West"
            },
            "Marquette": {
                kenpomRank: 26, 
                offensiveEfficiency: 117.8,
                defensiveEfficiency: 95.9, 
                recentForm: 7,               // Subjective: Solid recent performance in tough Big East
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 8,     // Subjective: Good tournament history with Final Four
                region: "Midwest"
            },
            
            // 8 Seeds
            "Louisville": {
                kenpomRank: 27,
                offensiveEfficiency: 118.1,
                defensiveEfficiency: 96.3, 
                recentForm: 8,               // Subjective: Won 11 straight before ACC title game loss
                injuryImpact: 9,             // Subjective: Reyne Smith returning from ankle injury
                tournamentExperience: 7,     // Subjective: Moderate tournament history, past championships
                region: "East"
            },
            "Gonzaga": {
                kenpomRank: 9,
                offensiveEfficiency: 123.6,
                defensiveEfficiency: 96.3, 
                recentForm: 8,               // Subjective: Strong finish to season, WCC champions
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 10,    // Subjective: Consistent tournament success, multiple Final Fours
                region: "West"
            },
            "Mississippi State": {
                kenpomRank: 33,
                offensiveEfficiency: 118.8,
                defensiveEfficiency: 98.7, 
                recentForm: 5,               // Subjective: Average recent performance, inconsistent
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 6,     // Subjective: Moderate tournament history
                region: "South"
            },
            "UConn": {
                kenpomRank: 8,
                offensiveEfficiency: 121.2,
                defensiveEfficiency: 102.4,
                recentForm: 6,               // Subjective: Average recent performance after strong start
                injuryImpact: 8,             // Subjective: Some injury concerns for rotation
                tournamentExperience: 10,    // Subjective: Defending champions with multiple titles
                region: "Midwest"
            },
            
            // 9 Seeds
            "Creighton": {
                kenpomRank: 34,
                offensiveEfficiency: 117.8,
                defensiveEfficiency: 98.1, 
                recentForm: 7,               // Subjective: Won 3 in a row before Big East Final loss
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 8,     // Subjective: Good tournament history, Elite Eight run
                region: "East"
            },
            "Georgia": {
                kenpomRank: 36,
                offensiveEfficiency: 115.4,
                defensiveEfficiency: 96.1, 
                recentForm: 6,               // Subjective: Average recent performance in SEC
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 4,     // Subjective: Limited tournament history
                region: "West"
            },
            "Baylor": {
                kenpomRank: 29,
                offensiveEfficiency: 120.9,
                defensiveEfficiency: 99.7, 
                recentForm: 5,               // Subjective: Average recent performance, struggled late
                injuryImpact: 7,             // Subjective: Some injury concerns for key players
                tournamentExperience: 9,     // Subjective: Recent national champion (2021)
                region: "South"
            },
            "Oklahoma": {
                kenpomRank: 39,
                offensiveEfficiency: 119.0,
                defensiveEfficiency: 100.7,
                recentForm: 5,               // Subjective: Bubble team, inconsistent late in season
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 6,     // Subjective: Moderate tournament history, Final Four runs
                region: "Midwest"
            },
            
            // 10 Seeds
            "Arkansas": {
                kenpomRank: 41,
                offensiveEfficiency: 113.0,
                defensiveEfficiency: 95.3, 
                recentForm: 4,               // Subjective: Underwhelming season after high expectations
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 8,     // Subjective: Good tournament history, recent Elite Eights
                region: "East"
            },
            "Vanderbilt": {
                kenpomRank: 47,
                offensiveEfficiency: 117.9,
                defensiveEfficiency: 101.8,
                recentForm: 7,               // Subjective: Solid recent performance, SEC tournament run
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 6,     // Subjective: Moderate tournament history, Sweet 16 runs
                region: "West"
            },
            "Utah State": {
                kenpomRank: 10,
                offensiveEfficiency: 119.0,
                defensiveEfficiency: 100.7,
                recentForm: 7,               // Subjective: Solid recent performance, MWC contender
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 6,     // Subjective: Moderate tournament history
                region: "South"
            },
            "New Mexico": {
                kenpomRank: 42,
                offensiveEfficiency: 112.4,
                defensiveEfficiency: 95.4, 
                recentForm: 6,               // Subjective: Average recent performance in MWC
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 5,     // Subjective: Some tournament history, limited recent success
                region: "Midwest"
            },
            
            // 11 Seeds
            "Xavier": {
                kenpomRank: 40,
                offensiveEfficiency: 116.3,
                defensiveEfficiency: 98.6, 
                recentForm: 7,               // Subjective: Solid recent performance, Big East tournament run
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 8,     // Subjective: Good tournament history, Elite Eight runs
                region: "East"
            },
            "VCU": {
                kenpomRank: 31,
                offensiveEfficiency: 116.2,
                defensiveEfficiency: 95.9, 
                recentForm: 8,               // Subjective: Strong recent performance, A-10 champions
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 8,     // Subjective: Good tournament history, Final Four run
                region: "West"
            },
            "North Carolina": {
                kenpomRank: 30,
                offensiveEfficiency: 119.8,
                defensiveEfficiency: 99.3, 
                recentForm: 3,               // Subjective: Poor finish, bubble team that barely got in
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 9,     // Subjective: Strong tournament history, multiple championships
                region: "South"
            },
            "Drake": {
                kenpomRank: 58,
                offensiveEfficiency: 112.8,
                defensiveEfficiency: 98.5, 
                recentForm: 8,               // Subjective: Strong mid-major performance, MVC champions
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 5,     // Subjective: Limited tournament history
                region: "Midwest"
            },
            
            // 12 Seeds
            "UC San Diego": {
                kenpomRank: 37,
                offensiveEfficiency: 115.1,
                defensiveEfficiency: 96.7, 
                recentForm: 8,               // Subjective: Strong recent performance, Big West champions
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 1,     // Subjective: First NCAA tournament appearance
                region: "East"
            },
            "Colorado State": {
                kenpomRank: 43,
                offensiveEfficiency: 116.1,
                defensiveEfficiency: 99.2, 
                recentForm: 6,               // Subjective: Average recent performance in MWC
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 5,     // Subjective: Some tournament history
                region: "West"
            },
            "McNeese": {
                kenpomRank: 59,
                offensiveEfficiency: 114.3,
                defensiveEfficiency: 100.5,
                recentForm: 8,               // Subjective: Strong mid-major performance, Southland champions
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 3,     // Subjective: Limited tournament history
                region: "South"
            },
            "Liberty": {
                kenpomRank: 60,
                offensiveEfficiency: 112.6,
                defensiveEfficiency: 98.9, 
                recentForm: 8,               // Subjective: Strong mid-major performance, A-Sun champions
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 5,     // Subjective: Limited tournament history
                region: "Midwest"
            },
            
            // 13 Seeds
            "Yale": {
                kenpomRank: 74,
                offensiveEfficiency: 115.2,
                defensiveEfficiency: 104.1,
                recentForm: 8,               // Subjective: Strong Ivy League performance, conference champion
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 4,     // Subjective: Limited tournament history
                region: "East"
            },
            "Grand Canyon": {
                kenpomRank: 96,
                offensiveEfficiency: 110.7,
                defensiveEfficiency: 100.7,
                recentForm: 8,               // Subjective: Strong recent performance, WAC champions
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 3,     // Subjective: Limited tournament history
                region: "West"
            },
            "Akron": {
                kenpomRank: 98,
                offensiveEfficiency: 113.9,
                defensiveEfficiency: 107.0,
                recentForm: 8,               // Subjective: Strong mid-major performance, MAC champions
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 4,     // Subjective: Some tournament history
                region: "South"
            },
            "High Point": {
                kenpomRank: 84,
                offensiveEfficiency: 118.5,
                defensiveEfficiency: 109.1,
                recentForm: 9,               // Subjective: Won conference tournament, 14-game win streak
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 1,     // Subjective: First NCAA tournament appearance
                region: "Midwest"
            },
            
            // 14 Seeds
            "Lipscomb": {
                kenpomRank: 82,
                offensiveEfficiency: 112.8,
                defensiveEfficiency: 103.3,
                recentForm: 8,               // Subjective: Strong mid-major performance, A-Sun champions
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 2,     // Subjective: Limited tournament history
                region: "East"
            },
            "Montana": {
                kenpomRank: 161,
                offensiveEfficiency: 110.8,
                defensiveEfficiency: 110.5,
                recentForm: 8,               // Subjective: Won conference tournament, Big Sky champions
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 3,     // Subjective: Limited tournament history
                region: "West"
            },
            "Troy": {
                kenpomRank: 93,
                offensiveEfficiency: 112.6,
                defensiveEfficiency: 99.6,
                recentForm: 8,               // Subjective: Strong mid-major performance, Sun Belt champions
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 2,     // Subjective: Limited tournament history
                region: "South"
            },
            "UNC Wilmington": {
                kenpomRank: 105,
                offensiveEfficiency: 112.4,
                defensiveEfficiency: 107.2,
                recentForm: 8,               // Subjective: Strong mid-major performance, CAA champions
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 3,     // Subjective: Limited tournament history
                region: "Midwest"
            },
            
            // 15 Seeds
            "Wofford": {
                kenpomRank: 122,
                offensiveEfficiency: 113.6,
                defensiveEfficiency: 109.5,
                recentForm: 8,               // Subjective: Strong mid-major performance, SoCon champions
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 5,     // Subjective: Some tournament history, past upsets
                region: "East"
            },
            "Robert Morris": {
                kenpomRank: 138,
                offensiveEfficiency: 111.2,
                defensiveEfficiency: 111.0,
                recentForm: 8,               // Subjective: Strong mid-major performance, Horizon champions
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 2,     // Subjective: Limited tournament history
                region: "West"
            },
            "Omaha": {
                kenpomRank: 181,
                offensiveEfficiency: 106.9,
                defensiveEfficiency: 109.3,
                recentForm: 8,               // Subjective: Strong finish, Summit League champions
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 1,     // Subjective: First NCAA tournament appearance
                region: "South"
            },
            "Bryant": {
                kenpomRank: 148,
                offensiveEfficiency: 110.8,
                defensiveEfficiency: 110.0,
                recentForm: 8,               // Subjective: Strong mid-major performance, America East champions
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 2,     // Subjective: Limited tournament history
                region: "Midwest"
            },
            
            // 16 Seeds
            "Mount St. Mary's": {
                kenpomRank: 238,
                offensiveEfficiency: 101.1,
                defensiveEfficiency: 107.1,
                recentForm: 8,               // Subjective: Strong finish, NEC champions
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 3,     // Subjective: Limited tournament history, play-in experience
                region: "East"
            },
            "Norfolk State": {
                kenpomRank: 179,
                offensiveEfficiency: 107.2,
                defensiveEfficiency: 108.7,
                recentForm: 8,               // Subjective: Strong finish, MEAC champions
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 3,     // Subjective: Limited tournament history, past upset win
                region: "West"
            },
            "SIU Edwardsville": {
                kenpomRank: 179,
                offensiveEfficiency: 107.5,
                defensiveEfficiency: 108.0,
                recentForm: 8,               // Subjective: Strong finish, OVC champions
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 1,     // Subjective: First NCAA tournament appearance
                region: "South"
            },
            "Alabama State": {
                kenpomRank: 301,
                offensiveEfficiency: 101.2,
                defensiveEfficiency: 110.8,
                recentForm: 8,               // Subjective: Strong finish, SWAC champions
                injuryImpact: 9,             // Subjective: Team largely healthy entering tournament
                tournamentExperience: 2,     // Subjective: Limited tournament history
                region: "Midwest"
            }
        };
        
        // Function to predict winner between two teams
        function predictWinner(team1, team2) {
            // Check if this matchup has an actual result already
            if (tournamentStatus.isLoaded) {
                const actualResult = tournamentStatus.completedGames.find(game => 
                    game.round === team1.round && 
                    ((game.team1 === team1.name && game.team2 === team2.name) || 
                    (game.team1 === team2.name && game.team2 === team1.name))
                );
                
                if (actualResult) {
                    // Return the actual winner
                    return team1.name === actualResult.winner ? 
                        {...team1, isActualResult: true} : 
                        {...team2, isActualResult: true};
                }
            }
            
            const seed1 = parseInt(team1.seed);
            const seed2 = parseInt(team2.seed);
            
            // Access team data directly from teamData object
            const team1Data = teamData[team1.name];
            const team2Data = teamData[team2.name];
            
            // Historical upset rates by seed matchup and round
            const historicalUpsetRates = {
                // First round (R64) specific matchups
                "1-16": 0.01,   // 1 in 100 chance (historical: 1 in ~135)
                "2-15": 0.065,  // ~6.5% chance (historical: ~8/124 = ~6.5%)
                "3-14": 0.13,   // ~13% chance (historical: ~16/124 = ~13%)
                "4-13": 0.21,   // ~21% chance (historical: ~26/124 = ~21%)
                "5-12": 0.355,  // ~35.5% chance (historical: ~44/124 = ~35.5%)
                "6-11": 0.37,   // ~37% chance (historical: ~46/124 = ~37%)
                "7-10": 0.40,   // ~40% chance (historical: ~50/124 = ~40%)
                "8-9": 0.50,    // ~50% chance (historical: ~62/124 = ~50%)
                
                // Later rounds - probability that lower seed wins
                "R32": 0.38,    // ~38% in Round of 32
                "S16": 0.38,    // ~34% in Sweet 16
                "E8": 0.36,     // ~30% in Elite 8
                "F4": 0.40,     // ~30% in Final Four
                "NCG": 0.45     // ~25% in Championship
            };
            
            // Determine base probability from historical matchup data
            let baseProbability;
            
            if (team1.round === 1) {
                // First round matchups use specific historical rates
                const matchupKey = (seed1 < seed2) ? `${seed1}-${seed2}` : `${seed2}-${seed1}`;
                if (historicalUpsetRates[matchupKey] !== undefined) {
                    baseProbability = (seed1 < seed2) ? 
                        1 - historicalUpsetRates[matchupKey] : 
                        historicalUpsetRates[matchupKey];
                } else {
                    // Fallback for matchups without historical data
                    const seedDifference = Math.abs(seed1 - seed2);
                    baseProbability = (seed1 < seed2) ?
                        0.5 + (seedDifference * 0.05) :
                        0.5 - (seedDifference * 0.05);
                }
            } else {
                // Later rounds use round-specific upset rates
                const roundKey = team1.round === 2 ? "R32" :
                                team1.round === 3 ? "S16" :
                                team1.round === 4 ? "E8" :
                                team1.round === 5 ? "F4" : "NCG";
                
                // Determine if there's a seed difference (potential upset)
                if (seed1 !== seed2) {
                    const higherSeed = Math.min(seed1, seed2);
                    const lowerSeed = Math.max(seed1, seed2);
                    
                    // Adjust probability based on magnitude of potential upset
                    const seedDifference = lowerSeed - higherSeed;
                    const upsetProbability = historicalUpsetRates[roundKey] * 
                        (1 - (0.05 * (lowerSeed - higherSeed - 1)));
                    
                    baseProbability = (seed1 < seed2) ?
                        1 - upsetProbability :
                        upsetProbability;
                } else {
                    // Equal seeds
                    baseProbability = 0.5;
                }
            }
            
            // Adjust for team quality factors from KenPom and other metrics
            
            // 1. Offensive-Defensive Efficiency Balance
            const team1EfficiencyDiff = team1Data.offensiveEfficiency - team1Data.defensiveEfficiency;
            const team2EfficiencyDiff = team2Data.offensiveEfficiency - team2Data.defensiveEfficiency;
            const efficiencyAdvantage = (team1EfficiencyDiff - team2EfficiencyDiff) * 0.003;
            
            // 2. KenPom Ranking Difference
            const kenpomFactor = [0.002, 0.002, 0.0015, 0.001, 0.0005, 0.0005][team1.round - 1] || 0.0005; // // Reduce KenPom impact in later rounds
            const kenpomDiff = (team2Data.kenpomRank - team1Data.kenpomRank) * kenpomFactor;
            
            // 3. Recent Form
            const formAdvantage = (team1Data.recentForm - team2Data.recentForm) * 0.01;
            
            // 4. Injury Impact
            const injuryAdvantage = (team1Data.injuryImpact - team2Data.injuryImpact) * 0.015;
            
            // 5. Tournament Experience
            const expAdvantage = (team1Data.tournamentExperience - team2Data.tournamentExperience) * 0.008;
            
            // Calculate final probability
            let finalProbability = baseProbability + efficiencyAdvantage + kenpomDiff + formAdvantage + 
                                injuryAdvantage + expAdvantage;
            
            // Add a random factor for unpredictability (March Madness!)
            // Random factor varies by round - early rounds are more chaotic
            const randomFactorMagnitude = [0.15, 0.12, 0.10, 0.10, 0.12, 0.15][team1.round - 1] || 0.15;
            const randomFactor = (Math.random() * randomFactorMagnitude * 2) - randomFactorMagnitude;
            finalProbability += randomFactor;

            // Constrain the Round of 64 upset rates to historical levels
            if (team1.round === 1) {
                const matchupKey = (seed1 < seed2) ? `${seed1}-${seed2}` : `${seed2}-${seed1}`;
                if (matchupKey === "1-16") {
                    // Make 1-16 upsets even rarer
                    if (seed1 === 1) finalProbability += 0.5;
                    else if (seed2 === 1) finalProbability -= 0.5;
                }
                // Fix 2-15 matchups to historical ~8-9%%
                else if (matchupKey === "2-15") {
                    if (seed1 === 2) finalProbability -= 0.385;
                    else if (seed2 === 2) finalProbability += 0.385;
                }
                // Fix 3-14 matchups to historical ~15-16%%
                else if (matchupKey === "3-14") {
                    if (seed1 === 3) finalProbability -= 0.285;
                    else if (seed2 === 3) finalProbability += 0.285;
                }
                // Fix 3-14 matchups to historical ~20-22%%
                else if (matchupKey === "4-13") {
                    if (seed1 === 4) finalProbability -= 0.22;
                    else if (seed2 === 4) finalProbability += 0.22;
                }
                // Fix 5-12 upsets to historical ~35%
                else if (matchupKey === "5-12") {
                    
                    if (seed1 === 5) finalProbability -= 0.08;
                    else if (seed2 === 5) finalProbability += 0.08;
                }
                // Fix 6-11 upsets to historical ~37-40%
                else if (matchupKey === "6-11") {
                    
                    if (seed1 === 6) finalProbability -= 0.075;
                    else if (seed2 === 6) finalProbability += 0.075;
                }
                // Fix 7-10 matchups to historical ~40%
                else if (matchupKey === "7-10") {
                    if (seed1 === 7) finalProbability -= 0.075;
                    else if (seed2 === 7) finalProbability += 0.075;
                }
                // Fix 8-9 matchups to be more like 50/50
                else if (matchupKey === "8-9") {
                    if (seed1 === 8) finalProbability -= 0.055;
                    else if (seed2 === 8) finalProbability += 0.055;
                }
            }


            // Adjust Sweet 16 advancement to favor #1 seeds over #2 seeds
            if (team1.round === 2) { // Round of 32 games
                if (seed1 === 1) finalProbability += 0.03;
                if (seed2 === 1) finalProbability -= 0.03;
                if (seed1 === 2) finalProbability -= 0.02;
                if (seed2 === 2) finalProbability += 0.02;
            }

            // Add a seed-specific adjustment for #2 seeds in later rounds
            if (seed1 === 2 || seed2 === 2) {
                // Apply stronger upset probability against #2 seeds in late rounds
                if (team1.round >= 4) { // Elite 8 and beyond
                    if (seed1 === 2) {
                        finalProbability -= 0.08; // Reduce #2 seed's chances
                    } else if (seed2 === 2) {
                        finalProbability += 0.08; // Increase chances against #2 seed
                    }
                }
            }
            
            // Ensure probability stays between 0.02 and 0.98
            finalProbability = Math.max(0.02, Math.min(0.98, finalProbability));
            
            // Simulate the game
            return Math.random() < finalProbability ?
                {...team1, isActualResult: false} : 
                {...team2, isActualResult: false};
        }
        
        // Define the tournament brackets
        const roundOf64 = [
            // First Round - Thursday
            {name: "Louisville", seed: "8", region: "East", round: 1},
            {name: "Creighton", seed: "9", region: "East", round: 1},
            {name: "Purdue", seed: "4", region: "Midwest", round: 1},
            {name: "High Point", seed: "13", region: "Midwest", round: 1},
            {name: "Wisconsin", seed: "3", region: "West", round: 1},
            {name: "Montana", seed: "14", region: "West", round: 1},
            {name: "Houston", seed: "1", region: "South", round: 1},
            {name: "SIU Edwardsville", seed: "16", region: "South", round: 1},
            {name: "Auburn", seed: "1", region: "Midwest", round: 1},
            {name: "Alabama State", seed: "16", region: "Midwest", round: 1},
            {name: "Clemson", seed: "5", region: "South", round: 1},
            {name: "McNeese", seed: "12", region: "South", round: 1},
            {name: "BYU", seed: "6", region: "West", round: 1},
            {name: "VCU", seed: "11", region: "West", round: 1},
            {name: "Gonzaga", seed: "8", region: "West", round: 1},
            {name: "Georgia", seed: "9", region: "West", round: 1},
            {name: "Tennessee", seed: "2", region: "East", round: 1},
            {name: "Wofford", seed: "15", region: "East", round: 1},
            {name: "Kansas", seed: "7", region: "East", round: 1},
            {name: "Arkansas", seed: "10", region: "East", round: 1},
            {name: "Texas A&M", seed: "4", region: "East", round: 1},
            {name: "Yale", seed: "13", region: "East", round: 1},
            {name: "Missouri", seed: "6", region: "Midwest", round: 1},
            {name: "Drake", seed: "11", region: "Midwest", round: 1},
            {name: "UCLA", seed: "7", region: "South", round: 1},
            {name: "Utah State", seed: "10", region: "South", round: 1},
            {name: "St. John's", seed: "2", region: "South", round: 1},
            {name: "Omaha", seed: "15", region: "South", round: 1},
            {name: "Michigan", seed: "5", region: "East", round: 1},
            {name: "UC San Diego", seed: "12", region: "East", round: 1},
            {name: "Texas Tech", seed: "3", region: "Midwest", round: 1},
            {name: "UNC Wilmington", seed: "14", region: "Midwest", round: 1},
            
            // First Round - Friday
            {name: "Mississippi State", seed: "8", region: "South", round: 1},
            {name: "Baylor", seed: "9", region: "South", round: 1},
            {name: "Alabama", seed: "2", region: "West", round: 1},
            {name: "Robert Morris", seed: "15", region: "West", round: 1},
            {name: "Iowa State", seed: "3", region: "East", round: 1},
            {name: "Lipscomb", seed: "14", region: "East", round: 1},
            {name: "Memphis", seed: "5", region: "West", round: 1},
            {name: "Colorado State", seed: "12", region: "West", round: 1},
            {name: "Duke", seed: "1", region: "East", round: 1},
            {name: "Mount St. Mary's", seed: "16", region: "East", round: 1},
            {name: "Saint Mary's", seed: "7", region: "West", round: 1},
            {name: "Vanderbilt", seed: "10", region: "West", round: 1},
            {name: "Ole Miss", seed: "6", region: "South", round: 1},
            {name: "North Carolina", seed: "11", region: "South", round: 1},
            {name: "Maryland", seed: "4", region: "West", round: 1},
            {name: "Grand Canyon", seed: "13", region: "West", round: 1},
            {name: "Florida", seed: "1", region: "West", round: 1},
            {name: "Norfolk State", seed: "16", region: "West", round: 1},
            {name: "Kentucky", seed: "3", region: "South", round: 1},
            {name: "Troy", seed: "14", region: "South", round: 1},
            {name: "Marquette", seed: "7", region: "Midwest", round: 1},
            {name: "New Mexico", seed: "10", region: "Midwest", round: 1},
            {name: "Arizona", seed: "4", region: "South", round: 1},
            {name: "Akron", seed: "13", region: "South", round: 1},
            {name: "UConn", seed: "8", region: "Midwest", round: 1},
            {name: "Oklahoma", seed: "9", region: "Midwest", round: 1},
            {name: "Illinois", seed: "6", region: "East", round: 1},
            {name: "Xavier", seed: "11", region: "East", round: 1},
            {name: "Michigan State", seed: "2", region: "Midwest", round: 1},
            {name: "Bryant", seed: "15", region: "Midwest", round: 1},
            {name: "Oregon", seed: "5", region: "Midwest", round: 1},
            {name: "Liberty", seed: "12", region: "Midwest", round: 1}
        ];
        
        // Run the tournament simulation
        function simulateTournament(initialTeams) {
            let currentRound = initialTeams;
            let roundNumber = 1;
            let results = {
                roundOf64: [],
                roundOf32: [],
                sweet16: [],
                elite8: [],
                finalFour: [],
                championship: [],
                champion: null
            };
            
            // Round of 64
            let roundOf32 = [];
            for (let i = 0; i < currentRound.length; i += 2) {
                const team1 = currentRound[i];
                const team2 = currentRound[i + 1];
                
                const winner = predictWinner(team1, team2);
                winner.round = 2; // Update round for winner
                
                results.roundOf64.push({
                    team1: team1.name,
                    seed1: team1.seed,
                    team2: team2.name,
                    seed2: team2.seed,
                    winner: winner.name,
                    winnerSeed: winner.seed,
                    isActualResult: winner.isActualResult
                });
                
                roundOf32.push(winner);
            }
            
            // Round of 32
            let sweet16 = [];
            for (let i = 0; i < roundOf32.length; i += 2) {
                const team1 = roundOf32[i];
                const team2 = roundOf32[i + 1];
                
                const winner = predictWinner(team1, team2);
                winner.round = 3; // Update round for winner
                
                results.roundOf32.push({
                    team1: team1.name,
                    seed1: team1.seed,
                    team2: team2.name,
                    seed2: team2.seed,
                    winner: winner.name,
                    winnerSeed: winner.seed,
                    isActualResult: winner.isActualResult
                });
                
                sweet16.push(winner);
            }
            
            // Sweet 16
            let elite8 = [];
            for (let i = 0; i < sweet16.length; i += 2) {
                const team1 = sweet16[i];
                const team2 = sweet16[i + 1];
                
                const winner = predictWinner(team1, team2);
                winner.round = 4; // Update round for winner
                
                results.sweet16.push({
                    team1: team1.name,
                    seed1: team1.seed,
                    team2: team2.name,
                    seed2: team2.seed,
                    winner: winner.name,
                    winnerSeed: winner.seed,
                    isActualResult: winner.isActualResult
                });
                
                elite8.push(winner);
            }
            
            // Elite 8
            let finalFour = [];
            for (let i = 0; i < elite8.length; i += 2) {
                const team1 = elite8[i];
                const team2 = elite8[i + 1];
                
                const winner = predictWinner(team1, team2);
                winner.round = 5; // Update round for winner
                
                results.elite8.push({
                    team1: team1.name,
                    seed1: team1.seed,
                    team2: team2.name,
                    seed2: team2.seed,
                    winner: winner.name,
                    winnerSeed: winner.seed,
                    isActualResult: winner.isActualResult
                });
                
                finalFour.push(winner);
            }
            
            // Final Four
            let championship = [];
            for (let i = 0; i < finalFour.length; i += 2) {
                const team1 = finalFour[i];
                const team2 = finalFour[i + 1];
                
                const winner = predictWinner(team1, team2);
                winner.round = 6; // Update round for winner
                
                results.finalFour.push({
                    team1: team1.name,
                    seed1: team1.seed,
                    team2: team2.name,
                    seed2: team2.seed,
                    winner: winner.name,
                    winnerSeed: winner.seed,
                    isActualResult: winner.isActualResult
                });
                
                championship.push(winner);
            }
            
            // Championship
            const team1 = championship[0];
            const team2 = championship[1];
            
            const champion = predictWinner(team1, team2);
            
            results.championship.push({
                team1: team1.name,
                seed1: team1.seed,
                team2: team2.name,
                seed2: team2.seed,
                winner: champion.name,
                winnerSeed: champion.seed,
                isActualResult: champion.isActualResult
            });
            
            results.champion = {
                name: champion.name,
                seed: champion.seed
            };
            
            return results;
        }
        
        // Function to display the results in a user-friendly way
        function displayResults(results) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            
            // Display Round of 64
            const round64Div = document.createElement('div');
            round64Div.className = 'round';
            round64Div.innerHTML = '<div class="round-title">Round of 64</div>';
            
            results.roundOf64.forEach(match => {
                const matchDiv = document.createElement('div');
                matchDiv.className = 'matchup';
                matchDiv.innerHTML = `
                    ${match.team1} (${match.seed1}) vs ${match.team2} (${match.seed2}) - 
                    <span class="${match.isActualResult ? 'actual-result' : 'winner'}">
                        ${match.winner} (${match.winnerSeed}) ${match.isActualResult ? 'won' : 'advances'}
                    </span>
                `;
                round64Div.appendChild(matchDiv);
            });
            
            resultsDiv.appendChild(round64Div);
            
            // Display Round of 32
            const round32Div = document.createElement('div');
            round32Div.className = 'round';
            round32Div.innerHTML = '<div class="round-title">Round of 32</div>';
            
            results.roundOf32.forEach(match => {
                const matchDiv = document.createElement('div');
                matchDiv.className = 'matchup';
                matchDiv.innerHTML = `
                    ${match.team1} (${match.seed1}) vs ${match.team2} (${match.seed2}) - 
                    <span class="${match.isActualResult ? 'actual-result' : 'winner'}">
                        ${match.winner} (${match.winnerSeed}) ${match.isActualResult ? 'won' : 'advances'}
                    </span>
                `;
                round32Div.appendChild(matchDiv);
            });
            
            resultsDiv.appendChild(round32Div);
            
            // Display Sweet 16
            const sweet16Div = document.createElement('div');
            sweet16Div.className = 'round';
            sweet16Div.innerHTML = '<div class="round-title">Sweet 16</div>';
            
            results.sweet16.forEach(match => {
                const matchDiv = document.createElement('div');
                matchDiv.className = 'matchup';
                matchDiv.innerHTML = `
                    ${match.team1} (${match.seed1}) vs ${match.team2} (${match.seed2}) - 
                    <span class="${match.isActualResult ? 'actual-result' : 'winner'}">
                        ${match.winner} (${match.winnerSeed}) ${match.isActualResult ? 'won' : 'advances'}
                    </span>
                `;
                sweet16Div.appendChild(matchDiv);
            });
            
            resultsDiv.appendChild(sweet16Div);
            
            // Display Elite 8
            const elite8Div = document.createElement('div');
            elite8Div.className = 'round';
            elite8Div.innerHTML = '<div class="round-title">Elite 8</div>';
            
            results.elite8.forEach(match => {
                const matchDiv = document.createElement('div');
                matchDiv.className = 'matchup';
                matchDiv.innerHTML = `
                    ${match.team1} (${match.seed1}) vs ${match.team2} (${match.seed2}) - 
                    <span class="${match.isActualResult ? 'actual-result' : 'winner'}">
                        ${match.winner} (${match.winnerSeed}) ${match.isActualResult ? 'won' : 'advances'}
                    </span>
                `;
                elite8Div.appendChild(matchDiv);
            });
            
            resultsDiv.appendChild(elite8Div);
            
            // Display Final Four
            const finalFourDiv = document.createElement('div');
            finalFourDiv.className = 'round';
            finalFourDiv.innerHTML = '<div class="round-title">Final Four</div>';
            
            results.finalFour.forEach(match => {
                const matchDiv = document.createElement('div');
                matchDiv.className = 'matchup';
                matchDiv.innerHTML = `
                    ${match.team1} (${match.seed1}) vs ${match.team2} (${match.seed2}) - 
                    <span class="${match.isActualResult ? 'actual-result' : 'winner'}">
                        ${match.winner} (${match.winnerSeed}) ${match.isActualResult ? 'won' : 'advances'}
                    </span>
                `;
                finalFourDiv.appendChild(matchDiv);
            });
            
            resultsDiv.appendChild(finalFourDiv);
            
            // Display Championship
            const championshipDiv = document.createElement('div');
            championshipDiv.className = 'round';
            championshipDiv.innerHTML = '<div class="round-title">Championship</div>';
            
            results.championship.forEach(match => {
                const matchDiv = document.createElement('div');
                matchDiv.className = 'matchup';
                matchDiv.innerHTML = `
                    ${match.team1} (${match.seed1}) vs ${match.team2} (${match.seed2}) - 
                    <span class="${match.isActualResult ? 'actual-result' : 'winner'}">
                        ${match.winner} (${match.winnerSeed}) ${match.isActualResult ? 'was the 2025 NCAA Champion!' : 'is the predicted 2025 NCAA Champion!'}
                    </span>
                `;
                championshipDiv.appendChild(matchDiv);
            });
            
            resultsDiv.appendChild(championshipDiv);
            
            // Display Champion
            const championDiv = document.createElement('div');
            championDiv.className = 'champion';
            championDiv.innerHTML = `
                🏆 ${results.champion.name} (${results.champion.seed}) 
                <br>2025 NCAA Tournament Champion
            `;
            
            resultsDiv.appendChild(championDiv);
            
            // Show save button
            document.getElementById('saveButton').style.display = 'block';
        }

        // Function to generate statistics about simulation outcomes
        function generateSimStats(numSimulations = 1000) {
            const stats = {
                upsetsByRound: {
                    "R64": { total: 0, byMatchup: {} },
                    "R32": { total: 0 },
                    "S16": { total: 0 },
                    "E8": { total: 0 },
                    "F4": { total: 0 },
                    "NCG": { total: 0 }
                },
                seedAdvancement: {
                    "R32": {}, // How often each seed advances to Round of 32
                    "S16": {}, // How often each seed advances to Sweet 16
                    "E8": {},  // How often each seed advances to Elite 8
                    "F4": {},  // How often each seed advances to Final Four
                    "NCG": {}, // How often each seed advances to Championship
                    "Champion": {} // How often each seed wins Championship
                },
                champsByRegion: {}
            };
            
            // Initialize seed advancement counters
            for (let seed = 1; seed <= 16; seed++) {
                stats.seedAdvancement.R32[seed] = 0;
                stats.seedAdvancement.S16[seed] = 0;
                stats.seedAdvancement.E8[seed] = 0;
                stats.seedAdvancement.F4[seed] = 0;
                stats.seedAdvancement.NCG[seed] = 0;
                stats.seedAdvancement.Champion[seed] = 0;
            }
            
            // Run simulations
            for (let i = 0; i < numSimulations; i++) {
                const results = simulateTournament(JSON.parse(JSON.stringify(roundOf64)));
                
                // Process Round of 64 results
                results.roundOf64.forEach(match => {
                    const higherSeed = Math.min(parseInt(match.seed1), parseInt(match.seed2));
                    const lowerSeed = Math.max(parseInt(match.seed1), parseInt(match.seed2));
                    const winnerSeed = parseInt(match.winnerSeed);
                    
                    // Track upsets
                    if (winnerSeed > higherSeed) {
                        stats.upsetsByRound.R64.total++;
                        
                        // Track by matchup
                        const matchupKey = `${higherSeed}-${lowerSeed}`;
                        if (!stats.upsetsByRound.R64.byMatchup[matchupKey]) {
                            stats.upsetsByRound.R64.byMatchup[matchupKey] = 0;
                        }
                        stats.upsetsByRound.R64.byMatchup[matchupKey]++;
                    }
                    
                    // Track seed advancement
                    stats.seedAdvancement.R32[winnerSeed]++;
                });
                
                // Process later rounds
                processRoundResults(results.roundOf32, "R32", "S16", stats);
                processRoundResults(results.sweet16, "S16", "E8", stats);
                processRoundResults(results.elite8, "E8", "F4", stats);
                processRoundResults(results.finalFour, "F4", "NCG", stats);
                processRoundResults(results.championship, "NCG", "Champion", stats);
                
                // Track champion region
                const championTeamInfo = roundOf64.find(team => team.name === results.champion.name);
                if (championTeamInfo) {
                    if (!stats.champsByRegion[championTeamInfo.region]) {
                        stats.champsByRegion[championTeamInfo.region] = 0;
                    }
                    stats.champsByRegion[championTeamInfo.region]++;
                }
            }
            
           // Convert counts to percentages
            const teamsPerSeed = 4;
            for (const round in stats.upsetsByRound) {
                if (round === "R64") {
                    for (const matchup in stats.upsetsByRound[round].byMatchup) {
                        stats.upsetsByRound[round].byMatchup[matchup] = 
                            (stats.upsetsByRound[round].byMatchup[matchup] / (numSimulations * teamsPerSeed) * 100).toFixed(1) + "%";
                    }
                }
                stats.upsetsByRound[round].total = 
                    (stats.upsetsByRound[round].total / (numSimulations * teamsPerSeed) * 100).toFixed(1) + "%";
            }

            // For seed advancement, divide by (numSimulations * 4) since there are 4 teams per seed
            for (const round in stats.seedAdvancement) {
                for (const seed in stats.seedAdvancement[round]) {
                    stats.seedAdvancement[round][seed] = 
                        (stats.seedAdvancement[round][seed] / (numSimulations * teamsPerSeed) * 100).toFixed(1) + "%";
                }
            }

            // For champions by region, divide by numSimulations since there's only one champion
            for (const region in stats.champsByRegion) {
                stats.champsByRegion[region] = 
                    (stats.champsByRegion[region] / numSimulations * 100).toFixed(1) + "%";
            }
            
            return stats;
        }
        
        // Helper function to process round results for stats
        function processRoundResults(roundResults, currentRound, nextRound, stats) {
            roundResults.forEach(match => {
                const higherSeed = Math.min(parseInt(match.seed1), parseInt(match.seed2));
                const lowerSeed = Math.max(parseInt(match.seed1), parseInt(match.seed2));
                const winnerSeed = parseInt(match.winnerSeed);
                
                // Track which seeds advance to next round
                stats.seedAdvancement[nextRound][winnerSeed]++;
                
                // Track upsets
                if (winnerSeed > higherSeed) {
                    stats.upsetsByRound[currentRound].total++;
                    
                    if (currentRound === "R64") {
                        // Track by matchup
                        const matchupKey = `${higherSeed}-${lowerSeed}`;
                        if (!stats.upsetsByRound[currentRound].byMatchup[matchupKey]) {
                            stats.upsetsByRound[currentRound].byMatchup[matchupKey] = 0;
                        }
                        stats.upsetsByRound[currentRound].byMatchup[matchupKey]++;
                    }
                }
            });
        }
        
        // Event listeners
        document.getElementById('simulateFullButton').addEventListener('click', function() {
            // Show loading spinner
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').innerHTML = '';
            document.getElementById('saveButton').style.display = 'none';
            
            // Use setTimeout to allow the UI to update before running the simulation
            setTimeout(function() {
                // Run simulation
                const results = simulateTournament(JSON.parse(JSON.stringify(roundOf64))); // Deep clone
                
                // Display results
                displayResults(results);
                
                // Hide loading spinner
                document.getElementById('loading').style.display = 'none';
            }, 100);
        });
        
        document.getElementById('saveButton').addEventListener('click', function() {
            // Save results functionality for Teams
            // For demonstration, we'll just alert the user
            microsoftTeams.dialog.submit("Bracket prediction saved!");
        });

        document.getElementById('loadActualResults').addEventListener('click', async function() {
            // Show loading spinner
            document.getElementById('loading').style.display = 'block';
            
            // Fetch actual results from API
            await fetchTournamentResults();
            
            // Run simulation with actual results
            const results = simulateTournament(JSON.parse(JSON.stringify(roundOf64)), true);
            
            // Display results and hide spinner
            displayResults(results);
            document.getElementById('loading').style.display = 'none';
        });

        document.getElementById('simulateRemainingButton').addEventListener('click', function() {
            // Check if results are loaded
            if (!tournamentStatus.isLoaded) {
                document.getElementById('apiStatus').textContent = "Please load actual results first.";
                return;
            }
            
            // Run simulation with actual results
            const results = simulateTournament(JSON.parse(JSON.stringify(roundOf64)), true);
            
            // Display results
            displayResults(results);
        });
        
        // Function to display statistical info
        function displayStatistics(stats) {
            const statsDiv = document.getElementById('statsResults');
            statsDiv.innerHTML = '';
            statsDiv.style.display = 'block';
            document.getElementById('results').style.display = 'none';
            
            // Create header
            const header = document.createElement('h2');
            header.textContent = 'Historical Simulation Statistics';
            header.style.textAlign = 'center';
            header.style.marginBottom = '20px';
            statsDiv.appendChild(header);
            
            // First Round Upset Stats
            const r64Header = document.createElement('h3');
            r64Header.textContent = 'First Round Upset Rates';
            r64Header.style.color = '#6264A7';
            statsDiv.appendChild(r64Header);
            
            const r64Table = document.createElement('table');
            r64Table.style.width = '100%';
            r64Table.style.marginBottom = '20px';
            r64Table.style.borderCollapse = 'collapse';
            
            // Create header row
            let headerRow = document.createElement('tr');
            ['Matchup', 'Upset Rate'].forEach(text => {
                const th = document.createElement('th');
                th.textContent = text;
                th.style.padding = '8px';
                th.style.backgroundColor = '#f2f2f2';
                th.style.border = '1px solid #ddd';
                headerRow.appendChild(th);
            });
            r64Table.appendChild(headerRow);
            
            // Add data rows sorted by matchup
            const matchups = Object.keys(stats.upsetsByRound.R64.byMatchup).sort();
            matchups.forEach(matchup => {
                const row = document.createElement('tr');
                
                const matchupCell = document.createElement('td');
                matchupCell.textContent = matchup + ' Matchup';
                matchupCell.style.padding = '8px';
                matchupCell.style.border = '1px solid #ddd';
                row.appendChild(matchupCell);
                
                const rateCell = document.createElement('td');
                rateCell.textContent = stats.upsetsByRound.R64.byMatchup[matchup];
                rateCell.style.padding = '8px';
                rateCell.style.border = '1px solid #ddd';
                row.appendChild(rateCell);
                
                r64Table.appendChild(row);
            });
            
            statsDiv.appendChild(r64Table);
            
            // Seed Advancement Stats
            const advHeader = document.createElement('h3');
            advHeader.textContent = 'Seed Advancement Rates';
            advHeader.style.color = '#6264A7';
            statsDiv.appendChild(advHeader);
            
            const advTable = document.createElement('table');
            advTable.style.width = '100%';
            advTable.style.marginBottom = '20px';
            advTable.style.borderCollapse = 'collapse';
            
            // Create header row with rounds
            headerRow = document.createElement('tr');
            ['Seed', 'Sweet 16', 'Elite 8', 'Final Four', 'Championship', 'Champion'].forEach(text => {
                const th = document.createElement('th');
                th.textContent = text;
                th.style.padding = '8px';
                th.style.backgroundColor = '#f2f2f2';
                th.style.border = '1px solid #ddd';
                headerRow.appendChild(th);
            });
            advTable.appendChild(headerRow);
            
            // Add data rows for seeds 1-16
            for (let seed = 1; seed <= 16; seed++) {
                const row = document.createElement('tr');
                
                const seedCell = document.createElement('td');
                seedCell.textContent = seed;
                seedCell.style.padding = '8px';
                seedCell.style.border = '1px solid #ddd';
                seedCell.style.fontWeight = 'bold';
                row.appendChild(seedCell);
                
                ['S16', 'E8', 'F4', 'NCG', 'Champion'].forEach(round => {
                    const cell = document.createElement('td');
                    cell.textContent = stats.seedAdvancement[round][seed];
                    cell.style.padding = '8px';
                    cell.style.border = '1px solid #ddd';
                    row.appendChild(cell);
                });
                
                advTable.appendChild(row);
            }
            
            statsDiv.appendChild(advTable);
            
            // Champion by Region
            const regionHeader = document.createElement('h3');
            regionHeader.textContent = 'Champion by Region';
            regionHeader.style.color = '#6264A7';
            statsDiv.appendChild(regionHeader);
            
            const regionTable = document.createElement('table');
            regionTable.style.width = '100%';
            regionTable.style.marginBottom = '20px';
            regionTable.style.borderCollapse = 'collapse';
            
            // Create header row
            headerRow = document.createElement('tr');
            ['Region', 'Championship Rate'].forEach(text => {
                const th = document.createElement('th');
                th.textContent = text;
                th.style.padding = '8px';
                th.style.backgroundColor = '#f2f2f2';
                th.style.border = '1px solid #ddd';
                headerRow.appendChild(th);
            });
            regionTable.appendChild(headerRow);
            
            // Add data rows
            Object.keys(stats.champsByRegion).sort().forEach(region => {
                const row = document.createElement('tr');
                
                const regionCell = document.createElement('td');
                regionCell.textContent = region;
                regionCell.style.padding = '8px';
                regionCell.style.border = '1px solid #ddd';
                row.appendChild(regionCell);
                
                const rateCell = document.createElement('td');
                rateCell.textContent = stats.champsByRegion[region];
                rateCell.style.padding = '8px';
                rateCell.style.border = '1px solid #ddd';
                row.appendChild(rateCell);
                
                regionTable.appendChild(row);
            });
            
            statsDiv.appendChild(regionTable);
            
            // Back to bracket button
            const backButton = document.createElement('button');
            backButton.textContent = 'Back to Bracket';
            backButton.style.backgroundColor = '#6264A7';
            backButton.style.color = 'white';
            backButton.style.border = 'none';
            backButton.style.padding = '10px 20px';
            backButton.style.fontSize = '16px';
            backButton.style.cursor = 'pointer';
            backButton.style.borderRadius = '4px';
            backButton.style.display = 'block';
            backButton.style.margin = '20px auto';
            
            backButton.addEventListener('click', function() {
                document.getElementById('statsResults').style.display = 'none';
                document.getElementById('results').style.display = 'block';
            });
            
            statsDiv.appendChild(backButton);
        }
        
        // Event listeners for the buttons
        document.getElementById('statsButton').addEventListener('click', function() {
            // Show loading spinner
            document.getElementById('loading').style.display = 'block';
            document.getElementById('statsResults').innerHTML = '';
            
            // Use setTimeout to allow the UI to update before running the simulation
            setTimeout(function() {
                // Generate stats from 1000 simulations
                const stats = generateSimStats(1000);
                
                // Display statistics
                displayStatistics(stats);
                
                // Hide loading spinner
                document.getElementById('loading').style.display = 'none';
            }, 100);
        });
    </script>
</body>
</html>
