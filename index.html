<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>March Madness Bracket Predictor</title>
    <script src="https://res.cdn.office.net/teams-js/2.0.0/js/MicrosoftTeams.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 20px;
        }
        button {
            background-color: #6264A7;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            display: block;
            margin: 20px auto;
        }
        button:hover {
            background-color: #4b4c8c;
        }
        .results {
            margin-top: 20px;
            border-top: 1px solid #ddd;
            padding-top: 20px;
        }
        .round {
            margin-bottom: 15px;
        }
        .round-title {
            font-weight: bold;
            color: #6264A7;
            margin-bottom: 10px;
            font-size: 18px;
        }
        .matchup {
            background-color: #f9f9f9;
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 4px;
        }
        .winner {
            font-weight: bold;
            color: #107C10;
        }
        .champion {
            text-align: center;
            font-size: 24px;
            margin: 30px 0;
            font-weight: bold;
            color: #107C10;
            padding: 20px;
            background-color: #f0f0f0;
            border-radius: 4px;
        }
        .team-data {
            margin-top: 30px;
        }
        .save-button {
            background-color: #107C10;
        }
        .save-button:hover {
            background-color: #0b5e0b;
        }
        #loading {
            text-align: center;
            display: none;
            margin: 20px 0;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #6264A7;
            animation: spin 1s ease infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>March Madness Bracket Predictor 2025</h1>
        
        <button id="simulateButton">Simulate Tournament</button>
        <button id="statsButton">Generate Historical Stats</button>
        
        <div id="loading">
            <div class="spinner"></div>
            <p>Running simulation...</p>
        </div>
        
        <div id="results" class="results"></div>
        <div id="statsResults" class="results" style="display: none;"></div>
        
        <button id="saveButton" class="save-button" style="display: none;">Save Results</button>
    </div>
    
    <script>
        // Initialize Teams SDK
        microsoftTeams.initialize();
        
        // Team data with statistics based on KenPom and other metrics
        const teamData = {
            // 1 Seeds
            "Houston": {
                kenpomRank: 3,
                offensiveEfficiency: 118.2, // Top 15
                defensiveEfficiency: 87.1,  // Top 3
                recentForm: 9,              // Scale 1-10
                injuryImpact: 9,            // Scale 1-10 (10 = fully healthy)
                tournamentExperience: 9,    // Scale 1-10
                region: "Midwest"
            },
            "Auburn": {
                kenpomRank: 2,
                offensiveEfficiency: 120.8, // Top 5
                defensiveEfficiency: 89.4,  // Top 10
                recentForm: 6,              // Lost 3 of last 4 before tournament
                injuryImpact: 9,            
                tournamentExperience: 7,
                region: "South"
            },
            "Duke": {
                kenpomRank: 1,
                offensiveEfficiency: 122.1, // Top 3
                defensiveEfficiency: 88.7,  // Top 5
                recentForm: 9,              // Very strong recent performance
                injuryImpact: 6,            // Cooper Flagg ankle injury
                tournamentExperience: 10,
                region: "East"
            },
            "Florida": {
                kenpomRank: 4,
                offensiveEfficiency: 123.4, // #1 in KenPom
                defensiveEfficiency: 91.8,  // Top 15
                recentForm: 8,
                injuryImpact: 9,
                tournamentExperience: 7,
                region: "West"
            },
            
            // 2 Seeds
            "Tennessee": {
                kenpomRank: 5,
                offensiveEfficiency: 115.4, // Top 25
                defensiveEfficiency: 85.9,  // #1 in KenPom
                recentForm: 7,
                injuryImpact: 8,
                tournamentExperience: 8,
                region: "East"
            },
            "Alabama": {
                kenpomRank: 7,
                offensiveEfficiency: 126.2, // Best offense (91 ppg)
                defensiveEfficiency: 100.5, // Very poor defense
                recentForm: 6,              // Lost 2 in a row before tournament
                injuryImpact: 9,
                tournamentExperience: 9,
                region: "West"
            },
            "Michigan State": {
                kenpomRank: 8,
                offensiveEfficiency: 116.8,
                defensiveEfficiency: 93.4,
                recentForm: 8,              // Strong finish to season
                injuryImpact: 9,
                tournamentExperience: 10,   // Izzo in March
                region: "Midwest"
            },
            "St. John's": {
                kenpomRank: 11,
                offensiveEfficiency: 114.7,
                defensiveEfficiency: 93.7,
                recentForm: 9,              // 30-4 overall, 18-2 in Big East
                injuryImpact: 9,
                tournamentExperience: 7,
                region: "South"
            },
            
            // Other notable teams
            "Wisconsin": {
                kenpomRank: 12,
                offensiveEfficiency: 117.1,
                defensiveEfficiency: 93.4,
                recentForm: 7,
                injuryImpact: 8,
                tournamentExperience: 8,
                region: "West"
            },
            "Iowa State": {
                kenpomRank: 6,
                offensiveEfficiency: 115.8,
                defensiveEfficiency: 90.1,  // Top 10
                recentForm: 8,
                injuryImpact: 6,            // Gilbert injury
                tournamentExperience: 8,
                region: "South"
            },
            "Kentucky": {
                kenpomRank: 14,
                offensiveEfficiency: 119.2,
                defensiveEfficiency: 97.3,
                recentForm: 6,
                injuryImpact: 9,
                tournamentExperience: 9,
                region: "South"
            },
            "Texas Tech": {
                kenpomRank: 10,
                offensiveEfficiency: 119.5,
                defensiveEfficiency: 95.1,
                recentForm: 7,              // Beat Houston
                injuryImpact: 9,
                tournamentExperience: 7,
                region: "Midwest"
            },
            "Gonzaga": {
                kenpomRank: 15,
                offensiveEfficiency: 118.7,
                defensiveEfficiency: 96.4,
                recentForm: 8,
                injuryImpact: 9,
                tournamentExperience: 10,
                region: "West"
            },
            "Oregon": {
                kenpomRank: 22,
                offensiveEfficiency: 114.6,
                defensiveEfficiency: 97.2,
                recentForm: 7,
                injuryImpact: 9,
                tournamentExperience: 7,
                region: "Midwest"
            },
            "UCLA": {
                kenpomRank: 35,
                offensiveEfficiency: 111.2,
                defensiveEfficiency: 95.6,
                recentForm: 6,
                injuryImpact: 8,
                tournamentExperience: 9,
                region: "South"
            },
            "North Carolina": {
                kenpomRank: 32,
                offensiveEfficiency: 112.8,
                defensiveEfficiency: 96.7,
                recentForm: 5,              // Bubble team
                injuryImpact: 9,
                tournamentExperience: 9,
                region: "South"
            }
        };

        // Function to get team data for a team (or generate defaults based on seed)
        function getTeamData(teamName) {
            if (teamData[teamName]) {
                return teamData[teamName];
            }
            
            // Default values based on seed
            const seedMatch = teamName.match(/\((\d+)\)/);
            const seed = seedMatch ? parseInt(seedMatch[1]) : 10; // Default to 10 if no seed found
            
            return {
                kenpomRank: 50 + (seed * 5),  // Estimate based on seed
                offensiveEfficiency: 110 - (seed * 0.8),
                defensiveEfficiency: 95 + (seed * 0.7),
                recentForm: 7,
                injuryImpact: 9,
                tournamentExperience: 6,
                region: "Unknown"
            };
        }
        
        // Function to predict winner between two teams
        function predictWinner(team1, team2) {
            const seed1 = parseInt(team1.seed);
            const seed2 = parseInt(team2.seed);
            
            // Get team data (either from defined data or defaults)
            const team1Data = getTeamData(team1.name);
            const team2Data = getTeamData(team2.name);
            
            // Historical upset rates by seed matchup and round
            const historicalUpsetRates = {
                // First round (R64) specific matchups
                "1-16": 0.01,   // 1 in 100 chance (historical: 1 in ~135)
                "2-15": 0.065,  // ~6.5% chance (historical: ~8/124 = ~6.5%)
                "3-14": 0.13,   // ~13% chance (historical: ~16/124 = ~13%)
                "4-13": 0.21,   // ~21% chance (historical: ~26/124 = ~21%)
                "5-12": 0.355,  // ~35.5% chance (historical: ~44/124 = ~35.5%)
                "6-11": 0.37,   // ~37% chance (historical: ~46/124 = ~37%)
                "7-10": 0.40,   // ~40% chance (historical: ~50/124 = ~40%)
                "8-9": 0.50,    // ~50% chance (historical: ~62/124 = ~50%)
                
                // Later rounds - probability that lower seed wins
                "R32": 0.38,    // ~38% in Round of 32
                "S16": 0.34,    // ~34% in Sweet 16
                "E8": 0.30,     // ~30% in Elite 8
                "F4": 0.30,     // ~30% in Final Four
                "NCG": 0.25     // ~25% in Championship
            };
            
            // Determine base probability from historical matchup data
            let baseProbability;
            
            if (team1.round === 1) {
                // First round matchups use specific historical rates
                const matchupKey = (seed1 < seed2) ? `${seed1}-${seed2}` : `${seed2}-${seed1}`;
                if (historicalUpsetRates[matchupKey] !== undefined) {
                    baseProbability = (seed1 < seed2) ? 
                        1 - historicalUpsetRates[matchupKey] : 
                        historicalUpsetRates[matchupKey];
                } else {
                    // Fallback for matchups without historical data
                    const seedDifference = Math.abs(seed1 - seed2);
                    baseProbability = (seed1 < seed2) ?
                        0.5 + (seedDifference * 0.05) :
                        0.5 - (seedDifference * 0.05);
                }
            } else {
                // Later rounds use round-specific upset rates
                const roundKey = team1.round === 2 ? "R32" :
                                team1.round === 3 ? "S16" :
                                team1.round === 4 ? "E8" :
                                team1.round === 5 ? "F4" : "NCG";
                
                // Determine if there's a seed difference (potential upset)
                if (seed1 !== seed2) {
                    const higherSeed = Math.min(seed1, seed2);
                    const lowerSeed = Math.max(seed1, seed2);
                    
                    // Adjust probability based on magnitude of potential upset
                    const seedDifference = lowerSeed - higherSeed;
                    const upsetProbability = historicalUpsetRates[roundKey] * 
                        (1 - (0.05 * (lowerSeed - higherSeed - 1)));
                    
                    baseProbability = (seed1 < seed2) ?
                        1 - upsetProbability :
                        upsetProbability;
                } else {
                    // Equal seeds
                    baseProbability = 0.5;
                }
            }
            
            // Adjust for team quality factors from KenPom and other metrics
            
            // 1. Offensive-Defensive Efficiency Balance
            const team1EfficiencyDiff = team1Data.offensiveEfficiency - team1Data.defensiveEfficiency;
            const team2EfficiencyDiff = team2Data.offensiveEfficiency - team2Data.defensiveEfficiency;
            const efficiencyAdvantage = (team1EfficiencyDiff - team2EfficiencyDiff) * 0.003;
            
            // 2. KenPom Ranking Difference
            const kenpomDiff = (team2Data.kenpomRank - team1Data.kenpomRank) * 0.002;
            
            // 3. Recent Form
            const formAdvantage = (team1Data.recentForm - team2Data.recentForm) * 0.01;
            
            // 4. Injury Impact
            const injuryAdvantage = (team1Data.injuryImpact - team2Data.injuryImpact) * 0.015;
            
            // 5. Tournament Experience
            const expAdvantage = (team1Data.tournamentExperience - team2Data.tournamentExperience) * 0.008;
            
            // Calculate final probability
            let finalProbability = baseProbability + efficiencyAdvantage + kenpomDiff + formAdvantage + 
                                injuryAdvantage + expAdvantage;
            
            // Add a random factor for unpredictability (March Madness!)
            // Random factor varies by round - early rounds are more chaotic
            const randomFactorMagnitude = [0.15, 0.12, 0.10, 0.08, 0.06, 0.05][team1.round - 1] || 0.05;
            const randomFactor = (Math.random() * randomFactorMagnitude * 2) - randomFactorMagnitude;
            finalProbability += randomFactor;
            
            // Ensure probability stays between 0.02 and 0.98
            finalProbability = Math.max(0.02, Math.min(0.98, finalProbability));
            
            // Simulate the game
            return Math.random() < finalProbability ? team1 : team2;
        }
        
        // Define the tournament brackets
        const roundOf64 = [
            // First Round - Thursday
            {name: "Louisville", seed: "8", region: "East", round: 1},
            {name: "Creighton", seed: "9", region: "East", round: 1},
            {name: "Purdue", seed: "4", region: "Midwest", round: 1},
            {name: "High Point", seed: "13", region: "Midwest", round: 1},
            {name: "Wisconsin", seed: "3", region: "West", round: 1},
            {name: "Montana", seed: "14", region: "West", round: 1},
            {name: "Houston", seed: "1", region: "South", round: 1},
            {name: "SIU Edwardsville", seed: "16", region: "South", round: 1},
            {name: "Auburn", seed: "1", region: "Midwest", round: 1},
            {name: "Alabama State", seed: "16", region: "Midwest", round: 1},
            {name: "Clemson", seed: "5", region: "South", round: 1},
            {name: "McNeese", seed: "12", region: "South", round: 1},
            {name: "BYU", seed: "6", region: "West", round: 1},
            {name: "VCU", seed: "11", region: "West", round: 1},
            {name: "Gonzaga", seed: "8", region: "West", round: 1},
            {name: "Georgia", seed: "9", region: "West", round: 1},
            {name: "Tennessee", seed: "2", region: "East", round: 1},
            {name: "Wofford", seed: "15", region: "East", round: 1},
            {name: "Kansas", seed: "7", region: "East", round: 1},
            {name: "Arkansas", seed: "10", region: "East", round: 1},
            {name: "Texas A&M", seed: "4", region: "East", round: 1},
            {name: "Yale", seed: "13", region: "East", round: 1},
            {name: "Missouri", seed: "6", region: "Midwest", round: 1},
            {name: "Drake", seed: "11", region: "Midwest", round: 1},
            {name: "UCLA", seed: "7", region: "South", round: 1},
            {name: "Utah State", seed: "10", region: "South", round: 1},
            {name: "St. John's", seed: "2", region: "South", round: 1},
            {name: "Omaha", seed: "15", region: "South", round: 1},
            {name: "Michigan", seed: "5", region: "East", round: 1},
            {name: "UC San Diego", seed: "12", region: "East", round: 1},
            {name: "Texas Tech", seed: "3", region: "Midwest", round: 1},
            {name: "UNC Wilmington", seed: "14", region: "Midwest", round: 1},
            
            // First Round - Friday
            {name: "Mississippi State", seed: "8", region: "South", round: 1},
            {name: "Baylor", seed: "9", region: "South", round: 1},
            {name: "Alabama", seed: "2", region: "West", round: 1},
            {name: "Robert Morris", seed: "15", region: "West", round: 1},
            {name: "Iowa State", seed: "3", region: "East", round: 1},
            {name: "Lipscomb", seed: "14", region: "East", round: 1},
            {name: "Memphis", seed: "5", region: "West", round: 1},
            {name: "Colorado State", seed: "12", region: "West", round: 1},
            {name: "Duke", seed: "1", region: "East", round: 1},
            {name: "Mount St. Mary's", seed: "16", region: "East", round: 1},
            {name: "Saint Mary's", seed: "7", region: "West", round: 1},
            {name: "Vanderbilt", seed: "10", region: "West", round: 1},
            {name: "Ole Miss", seed: "6", region: "South", round: 1},
            {name: "North Carolina", seed: "11", region: "South", round: 1},
            {name: "Maryland", seed: "4", region: "West", round: 1},
            {name: "Grand Canyon", seed: "13", region: "West", round: 1},
            {name: "Florida", seed: "1", region: "West", round: 1},
            {name: "Norfolk State", seed: "16", region: "West", round: 1},
            {name: "Kentucky", seed: "3", region: "South", round: 1},
            {name: "Troy", seed: "14", region: "South", round: 1},
            {name: "Marquette", seed: "7", region: "Midwest", round: 1},
            {name: "New Mexico", seed: "10", region: "Midwest", round: 1},
            {name: "Arizona", seed: "4", region: "South", round: 1},
            {name: "Akron", seed: "13", region: "South", round: 1},
            {name: "UConn", seed: "8", region: "Midwest", round: 1},
            {name: "Oklahoma", seed: "9", region: "Midwest", round: 1},
            {name: "Illinois", seed: "6", region: "East", round: 1},
            {name: "Xavier", seed: "11", region: "East", round: 1},
            {name: "Michigan State", seed: "2", region: "Midwest", round: 1},
            {name: "Bryant", seed: "15", region: "Midwest", round: 1},
            {name: "Oregon", seed: "5", region: "Midwest", round: 1},
            {name: "Liberty", seed: "12", region: "Midwest", round: 1}
        ];
        
        // Run the tournament simulation
        function simulateTournament(initialTeams) {
            let currentRound = initialTeams;
            let roundNumber = 1;
            let results = {
                roundOf64: [],
                roundOf32: [],
                sweet16: [],
                elite8: [],
                finalFour: [],
                championship: [],
                champion: null
            };
            
            // Round of 64
            let roundOf32 = [];
            for (let i = 0; i < currentRound.length; i += 2) {
                const team1 = currentRound[i];
                const team2 = currentRound[i + 1];
                
                const winner = predictWinner(team1, team2);
                winner.round = 2; // Update round for winner
                
                results.roundOf64.push({
                    team1: team1.name,
                    seed1: team1.seed,
                    team2: team2.name,
                    seed2: team2.seed,
                    winner: winner.name,
                    winnerSeed: winner.seed
                });
                
                roundOf32.push(winner);
            }
            
            // Round of 32
            let sweet16 = [];
            for (let i = 0; i < roundOf32.length; i += 2) {
                const team1 = roundOf32[i];
                const team2 = roundOf32[i + 1];
                
                const winner = predictWinner(team1, team2);
                winner.round = 3; // Update round for winner
                
                results.roundOf32.push({
                    team1: team1.name,
                    seed1: team1.seed,
                    team2: team2.name,
                    seed2: team2.seed,
                    winner: winner.name,
                    winnerSeed: winner.seed
                });
                
                sweet16.push(winner);
            }
            
            // Sweet 16
            let elite8 = [];
            for (let i = 0; i < sweet16.length; i += 2) {
                const team1 = sweet16[i];
                const team2 = sweet16[i + 1];
                
                const winner = predictWinner(team1, team2);
                winner.round = 4; // Update round for winner
                
                results.sweet16.push({
                    team1: team1.name,
                    seed1: team1.seed,
                    team2: team2.name,
                    seed2: team2.seed,
                    winner: winner.name,
                    winnerSeed: winner.seed
                });
                
                elite8.push(winner);
            }
            
            // Elite 8
            let finalFour = [];
            for (let i = 0; i < elite8.length; i += 2) {
                const team1 = elite8[i];
                const team2 = elite8[i + 1];
                
                const winner = predictWinner(team1, team2);
                winner.round = 5; // Update round for winner
                
                results.elite8.push({
                    team1: team1.name,
                    seed1: team1.seed,
                    team2: team2.name,
                    seed2: team2.seed,
                    winner: winner.name,
                    winnerSeed: winner.seed
                });
                
                finalFour.push(winner);
            }
            
            // Final Four
            let championship = [];
            for (let i = 0; i < finalFour.length; i += 2) {
                const team1 = finalFour[i];
                const team2 = finalFour[i + 1];
                
                const winner = predictWinner(team1, team2);
                winner.round = 6; // Update round for winner
                
                results.finalFour.push({
                    team1: team1.name,
                    seed1: team1.seed,
                    team2: team2.name,
                    seed2: team2.seed,
                    winner: winner.name,
                    winnerSeed: winner.seed
                });
                
                championship.push(winner);
            }
            
            // Championship
            const team1 = championship[0];
            const team2 = championship[1];
            
            const champion = predictWinner(team1, team2);
            
            results.championship.push({
                team1: team1.name,
                seed1: team1.seed,
                team2: team2.name,
                seed2: team2.seed,
                winner: champion.name,
                winnerSeed: champion.seed
            });
            
            results.champion = {
                name: champion.name,
                seed: champion.seed
            };
            
            return results;
        }
        
        // Function to display the results in a user-friendly way
        function displayResults(results) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            
            // Display Round of 64
            const round64Div = document.createElement('div');
            round64Div.className = 'round';
            round64Div.innerHTML = '<div class="round-title">Round of 64</div>';
            
            results.roundOf64.forEach(match => {
                const matchDiv = document.createElement('div');
                matchDiv.className = 'matchup';
                matchDiv.innerHTML = `
                    ${match.team1} (${match.seed1}) vs ${match.team2} (${match.seed2}) - 
                    <span class="winner">${match.winner} (${match.winnerSeed}) advances</span>
                `;
                round64Div.appendChild(matchDiv);
            });
            
            resultsDiv.appendChild(round64Div);
            
            // Display Round of 32
            const round32Div = document.createElement('div');
            round32Div.className = 'round';
            round32Div.innerHTML = '<div class="round-title">Round of 32</div>';
            
            results.roundOf32.forEach(match => {
                const matchDiv = document.createElement('div');
                matchDiv.className = 'matchup';
                matchDiv.innerHTML = `
                    ${match.team1} (${match.seed1}) vs ${match.team2} (${match.seed2}) - 
                    <span class="winner">${match.winner} (${match.winnerSeed}) advances</span>
                `;
                round32Div.appendChild(matchDiv);
            });
            
            resultsDiv.appendChild(round32Div);
            
            // Display Sweet 16
            const sweet16Div = document.createElement('div');
            sweet16Div.className = 'round';
            sweet16Div.innerHTML = '<div class="round-title">Sweet 16</div>';
            
            results.sweet16.forEach(match => {
                const matchDiv = document.createElement('div');
                matchDiv.className = 'matchup';
                matchDiv.innerHTML = `
                    ${match.team1} (${match.seed1}) vs ${match.team2} (${match.seed2}) - 
                    <span class="winner">${match.winner} (${match.winnerSeed}) advances</span>
                `;
                sweet16Div.appendChild(matchDiv);
            });
            
            resultsDiv.appendChild(sweet16Div);
            
            // Display Elite 8
            const elite8Div = document.createElement('div');
            elite8Div.className = 'round';
            elite8Div.innerHTML = '<div class="round-title">Elite 8</div>';
            
            results.elite8.forEach(match => {
                const matchDiv = document.createElement('div');
                matchDiv.className = 'matchup';
                matchDiv.innerHTML = `
                    ${match.team1} (${match.seed1}) vs ${match.team2} (${match.seed2}) - 
                    <span class="winner">${match.winner} (${match.winnerSeed}) advances</span>
                `;
                elite8Div.appendChild(matchDiv);
            });
            
            resultsDiv.appendChild(elite8Div);
            
            // Display Final Four
            const finalFourDiv = document.createElement('div');
            finalFourDiv.className = 'round';
            finalFourDiv.innerHTML = '<div class="round-title">Final Four</div>';
            
            results.finalFour.forEach(match => {
                const matchDiv = document.createElement('div');
                matchDiv.className = 'matchup';
                matchDiv.innerHTML = `
                    ${match.team1} (${match.seed1}) vs ${match.team2} (${match.seed2}) - 
                    <span class="winner">${match.winner} (${match.winnerSeed}) advances</span>
                `;
                finalFourDiv.appendChild(matchDiv);
            });
            
            resultsDiv.appendChild(finalFourDiv);
            
            // Display Championship
            const championshipDiv = document.createElement('div');
            championshipDiv.className = 'round';
            championshipDiv.innerHTML = '<div class="round-title">Championship</div>';
            
            results.championship.forEach(match => {
                const matchDiv = document.createElement('div');
                matchDiv.className = 'matchup';
                matchDiv.innerHTML = `
                    ${match.team1} (${match.seed1}) vs ${match.team2} (${match.seed2}) - 
                    <span class="winner">${match.winner} (${match.winnerSeed}) is the 2025 NCAA Champion!</span>
                `;
                championshipDiv.appendChild(matchDiv);
            });
            
            resultsDiv.appendChild(championshipDiv);
            
            // Display Champion
            const championDiv = document.createElement('div');
            championDiv.className = 'champion';
            championDiv.innerHTML = `
                🏆 ${results.champion.name} (${results.champion.seed}) 
                <br>2025 NCAA Tournament Champion
            `;
            
            resultsDiv.appendChild(championDiv);
            
            // Show save button
            document.getElementById('saveButton').style.display = 'block';
        }

        // Function to generate statistics about simulation outcomes
        function generateSimStats(numSimulations = 1000) {
            const stats = {
                upsetsByRound: {
                    "R64": { total: 0, byMatchup: {} },
                    "R32": { total: 0 },
                    "S16": { total: 0 },
                    "E8": { total: 0 },
                    "F4": { total: 0 },
                    "NCG": { total: 0 }
                },
                seedAdvancement: {
                    "R32": {}, // How often each seed advances to Round of 32
                    "S16": {}, // How often each seed advances to Sweet 16
                    "E8": {},  // How often each seed advances to Elite 8
                    "F4": {},  // How often each seed advances to Final Four
                    "NCG": {}, // How often each seed advances to Championship
                    "Champion": {} // How often each seed wins Championship
                },
                champsByRegion: {}
            };
            
            // Initialize seed advancement counters
            for (let seed = 1; seed <= 16; seed++) {
                stats.seedAdvancement.R32[seed] = 0;
                stats.seedAdvancement.S16[seed] = 0;
                stats.seedAdvancement.E8[seed] = 0;
                stats.seedAdvancement.F4[seed] = 0;
                stats.seedAdvancement.NCG[seed] = 0;
                stats.seedAdvancement.Champion[seed] = 0;
            }
            
            // Run simulations
            for (let i = 0; i < numSimulations; i++) {
                const results = simulateTournament(JSON.parse(JSON.stringify(roundOf64)));
                
                // Process Round of 64 results
                results.roundOf64.forEach(match => {
                    const higherSeed = Math.min(parseInt(match.seed1), parseInt(match.seed2));
                    const lowerSeed = Math.max(parseInt(match.seed1), parseInt(match.seed2));
                    const winnerSeed = parseInt(match.winnerSeed);
                    
                    // Track upsets
                    if (winnerSeed > higherSeed) {
                        stats.upsetsByRound.R64.total++;
                        
                        // Track by matchup
                        const matchupKey = `${higherSeed}-${lowerSeed}`;
                        if (!stats.upsetsByRound.R64.byMatchup[matchupKey]) {
                            stats.upsetsByRound.R64.byMatchup[matchupKey] = 0;
                        }
                        stats.upsetsByRound.R64.byMatchup[matchupKey]++;
                    }
                    
                    // Track seed advancement
                    stats.seedAdvancement.R32[winnerSeed]++;
                });
                
                // Process later rounds
                processRoundResults(results.roundOf32, "R32", "S16", stats);
                processRoundResults(results.sweet16, "S16", "E8", stats);
                processRoundResults(results.elite8, "E8", "F4", stats);
                processRoundResults(results.finalFour, "F4", "NCG", stats);
                processRoundResults(results.championship, "NCG", "Champion", stats);
                
                // Track champion region
                const championTeamInfo = roundOf64.find(team => team.name === results.champion.name);
                if (championTeamInfo) {
                    if (!stats.champsByRegion[championTeamInfo.region]) {
                        stats.champsByRegion[championTeamInfo.region] = 0;
                    }
                    stats.champsByRegion[championTeamInfo.region]++;
                }
            }
            
            // Convert counts to percentages
            for (const round in stats.upsetsByRound) {
                if (round === "R64") {
                    for (const matchup in stats.upsetsByRound[round].byMatchup) {
                        stats.upsetsByRound[round].byMatchup[matchup] = 
                            (stats.upsetsByRound[round].byMatchup[matchup] / numSimulations * 100).toFixed(1) + "%";
                    }
                }
                stats.upsetsByRound[round].total = 
                    (stats.upsetsByRound[round].total / numSimulations * 100).toFixed(1) + "%";
            }
            
            for (const round in stats.seedAdvancement) {
                for (const seed in stats.seedAdvancement[round]) {
                    stats.seedAdvancement[round][seed] = 
                        (stats.seedAdvancement[round][seed] / numSimulations * 100).toFixed(1) + "%";
                }
            }
            
            for (const region in stats.champsByRegion) {
                stats.champsByRegion[region] = 
                    (stats.champsByRegion[region] / numSimulations * 100).toFixed(1) + "%";
            }
            
            return stats;
        }
        
        // Helper function to process round results for stats
        function processRoundResults(roundResults, currentRound, nextRound, stats) {
            roundResults.forEach(match => {
                const higherSeed = Math.min(parseInt(match.seed1), parseInt(match.seed2));
                const lowerSeed = Math.max(parseInt(match.seed1), parseInt(match.seed2));
                const winnerSeed = parseInt(match.winnerSeed);
                
                // Track upsets
                if (winnerSeed > higherSeed) {
                    stats.upsetsByRound[currentRound].total++;
                }
                
                // Track seed advancement
                stats.seedAdvancement[nextRound][winnerSeed]++;
            });
        }
        
        // Event listeners
        document.getElementById('simulateButton').addEventListener('click', function() {
            // Show loading spinner
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').innerHTML = '';
            document.getElementById('saveButton').style.display = 'none';
            
            // Use setTimeout to allow the UI to update before running the simulation
            setTimeout(function() {
                // Run simulation
                const results = simulateTournament(JSON.parse(JSON.stringify(roundOf64))); // Deep clone
                
                // Display results
                displayResults(results);
                
                // Hide loading spinner
                document.getElementById('loading').style.display = 'none';
            }, 100);
        });
        
        document.getElementById('saveButton').addEventListener('click', function() {
            // Save results functionality for Teams
            // For demonstration, we'll just alert the user
            microsoftTeams.dialog.submit("Bracket prediction saved!");
        });
        
        // Function to display statistical info
        function displayStatistics(stats) {
            const statsDiv = document.getElementById('statsResults');
            statsDiv.innerHTML = '';
            statsDiv.style.display = 'block';
            document.getElementById('results').style.display = 'none';
            
            // Create header
            const header = document.createElement('h2');
            header.textContent = 'Historical Simulation Statistics';
            header.style.textAlign = 'center';
            header.style.marginBottom = '20px';
            statsDiv.appendChild(header);
            
            // First Round Upset Stats
            const r64Header = document.createElement('h3');
            r64Header.textContent = 'First Round Upset Rates';
            r64Header.style.color = '#6264A7';
            statsDiv.appendChild(r64Header);
            
            const r64Table = document.createElement('table');
            r64Table.style.width = '100%';
            r64Table.style.marginBottom = '20px';
            r64Table.style.borderCollapse = 'collapse';
            
            // Create header row
            let headerRow = document.createElement('tr');
            ['Matchup', 'Upset Rate'].forEach(text => {
                const th = document.createElement('th');
                th.textContent = text;
                th.style.padding = '8px';
                th.style.backgroundColor = '#f2f2f2';
                th.style.border = '1px solid #ddd';
                headerRow.appendChild(th);
            });
            r64Table.appendChild(headerRow);
            
            // Add data rows sorted by matchup
            const matchups = Object.keys(stats.upsetsByRound.R64.byMatchup).sort();
            matchups.forEach(matchup => {
                const row = document.createElement('tr');
                
                const matchupCell = document.createElement('td');
                matchupCell.textContent = matchup + ' Matchup';
                matchupCell.style.padding = '8px';
                matchupCell.style.border = '1px solid #ddd';
                row.appendChild(matchupCell);
                
                const rateCell = document.createElement('td');
                rateCell.textContent = stats.upsetsByRound.R64.byMatchup[matchup];
                rateCell.style.padding = '8px';
                rateCell.style.border = '1px solid #ddd';
                row.appendChild(rateCell);
                
                r64Table.appendChild(row);
            });
            
            statsDiv.appendChild(r64Table);
            
            // Seed Advancement Stats
            const advHeader = document.createElement('h3');
            advHeader.textContent = 'Seed Advancement Rates';
            advHeader.style.color = '#6264A7';
            statsDiv.appendChild(advHeader);
            
            const advTable = document.createElement('table');
            advTable.style.width = '100%';
            advTable.style.marginBottom = '20px';
            advTable.style.borderCollapse = 'collapse';
            
            // Create header row with rounds
            headerRow = document.createElement('tr');
            ['Seed', 'Sweet 16', 'Elite 8', 'Final Four', 'Championship', 'Champion'].forEach(text => {
                const th = document.createElement('th');
                th.textContent = text;
                th.style.padding = '8px';
                th.style.backgroundColor = '#f2f2f2';
                th.style.border = '1px solid #ddd';
                headerRow.appendChild(th);
            });
            advTable.appendChild(headerRow);
            
            // Add data rows for seeds 1-16
            for (let seed = 1; seed <= 16; seed++) {
                const row = document.createElement('tr');
                
                const seedCell = document.createElement('td');
                seedCell.textContent = seed;
                seedCell.style.padding = '8px';
                seedCell.style.border = '1px solid #ddd';
                seedCell.style.fontWeight = 'bold';
                row.appendChild(seedCell);
                
                ['S16', 'E8', 'F4', 'NCG', 'Champion'].forEach(round => {
                    const cell = document.createElement('td');
                    cell.textContent = stats.seedAdvancement[round][seed];
                    cell.style.padding = '8px';
                    cell.style.border = '1px solid #ddd';
                    row.appendChild(cell);
                });
                
                advTable.appendChild(row);
            }
            
            statsDiv.appendChild(advTable);
            
            // Champion by Region
            const regionHeader = document.createElement('h3');
            regionHeader.textContent = 'Champion by Region';
            regionHeader.style.color = '#6264A7';
            statsDiv.appendChild(regionHeader);
            
            const regionTable = document.createElement('table');
            regionTable.style.width = '100%';
            regionTable.style.marginBottom = '20px';
            regionTable.style.borderCollapse = 'collapse';
            
            // Create header row
            headerRow = document.createElement('tr');
            ['Region', 'Championship Rate'].forEach(text => {
                const th = document.createElement('th');
                th.textContent = text;
                th.style.padding = '8px';
                th.style.backgroundColor = '#f2f2f2';
                th.style.border = '1px solid #ddd';
                headerRow.appendChild(th);
            });
            regionTable.appendChild(headerRow);
            
            // Add data rows
            Object.keys(stats.champsByRegion).sort().forEach(region => {
                const row = document.createElement('tr');
                
                const regionCell = document.createElement('td');
                regionCell.textContent = region;
                regionCell.style.padding = '8px';
                regionCell.style.border = '1px solid #ddd';
                row.appendChild(regionCell);
                
                const rateCell = document.createElement('td');
                rateCell.textContent = stats.champsByRegion[region];
                rateCell.style.padding = '8px';
                rateCell.style.border = '1px solid #ddd';
                row.appendChild(rateCell);
                
                regionTable.appendChild(row);
            });
            
            statsDiv.appendChild(regionTable);
            
            // Back to bracket button
            const backButton = document.createElement('button');
            backButton.textContent = 'Back to Bracket';
            backButton.style.backgroundColor = '#6264A7';
            backButton.style.color = 'white';
            backButton.style.border = 'none';
            backButton.style.padding = '10px 20px';
            backButton.style.fontSize = '16px';
            backButton.style.cursor = 'pointer';
            backButton.style.borderRadius = '4px';
            backButton.style.display = 'block';
            backButton.style.margin = '20px auto';
            
            backButton.addEventListener('click', function() {
                document.getElementById('statsResults').style.display = 'none';
                document.getElementById('results').style.display = 'block';
            });
            
            statsDiv.appendChild(backButton);
        }
        
        // Event listeners for the buttons
        document.getElementById('statsButton').addEventListener('click', function() {
            // Show loading spinner
            document.getElementById('loading').style.display = 'block';
            document.getElementById('statsResults').innerHTML = '';
            
            // Use setTimeout to allow the UI to update before running the simulation
            setTimeout(function() {
                // Generate stats from 1000 simulations
                const stats = generateSimStats(1000);
                
                // Display statistics
                displayStatistics(stats);
                
                // Hide loading spinner
                document.getElementById('loading').style.display = 'none';
            }, 100);
        });
    </script>
</body>
</html>
